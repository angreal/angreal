---
id: implement-floxservices-and
level: task
title: "Implement FloxServices and FloxServiceHandle classes"
short_code: "ANG-T-0015"
created_at: 2026-01-13T01:30:12.769472+00:00
updated_at: 2026-01-13T01:55:52.844548+00:00
parent: ANG-I-0008
blocked_by: []
archived: false

tags:
  - "#task"
  - "#phase/completed"


exit_criteria_met: false
strategy_id: NULL
initiative_id: ANG-I-0008
---

# Implement FloxServices and FloxServiceHandle classes

## Objective

Implement the `FloxServices` class for managing Flox services lifecycle and `FloxServiceHandle` for persisting service state across task invocations.

## Acceptance Criteria

## Acceptance Criteria

- [x] `FloxServices` pyclass with reference to parent Flox environment
- [x] `start(*services)` - Run `flox services start [svc...]`, return `FloxServiceHandle`
- [x] `stop()` - Run `flox services stop`
- [x] `status()` - Parse `flox services status` output, return list of `ServiceInfo` objects
- [x] `logs(service, follow=False, tail=None)` - Get service logs
- [x] `restart(*services)` - Restart services (bonus feature)
- [x] `FloxServiceHandle` pyclass capturing started services and PIDs
- [x] `handle.save(path=".flox-services.json")` - Serialize handle to JSON
- [x] `FloxServiceHandle.load(path)` - Classmethod to deserialize handle
- [x] `handle.stop()` - Stop services using saved state
- [x] `ServiceInfo` pyclass for structured service data
- [x] `Flox.services` property - Returns `FloxServices` instance
- [x] Python tests for service lifecycle (43 Flox tests total)

## Implementation Notes

### FloxServiceHandle JSON Format
```json
{
  "flox_env_path": "/path/to/project",
  "services": [
    {"name": "postgres", "pid": 12345},
    {"name": "redis", "pid": 12346}
  ],
  "started_at": "2026-01-13T01:30:00Z"
}
```

### Service Status Parsing
`flox services status` outputs:
```
NAME      STATUS   PID
postgres  Running  12345
redis     Running  12346
```

Parse this tabular output to extract service info.

### Dependencies
- Requires ANG-T-0013 (core Rust module)
- Requires ANG-T-0014 (Flox class for `services` property)

## Status Updates

### Completed

**Files Modified:**
- `crates/angreal/src/python_bindings/integrations/flox.rs` - Added FloxServices, FloxServiceHandle, ServiceInfo pyclasses
- `crates/angreal/src/integrations/flox/mod.rs` - Fixed service status parsing to handle "does not have any services" error
- `py_tests/integrations/test_flox.py` - Added 16 new tests for service classes

**Implementation Details:**
- `FloxServices` class wraps Flox CLI service commands (start, stop, status, logs, restart)
- `FloxServiceHandle` captures service state and can be saved/loaded as JSON for persistence
- `ServiceInfo` class provides structured access to service name, status, and PID
- `Flox.services` property returns a FloxServices instance for the environment
- All 132 tests passing (43 Flox-specific tests)
