---
id: implement-flox-python-bindings-and
level: task
title: "Implement Flox Python bindings and Flox class"
short_code: "ANG-T-0014"
created_at: 2026-01-13T01:30:12.733163+00:00
updated_at: 2026-01-13T01:45:49.702853+00:00
parent: ANG-I-0008
blocked_by: []
archived: false

tags:
  - "#task"
  - "#phase/completed"


exit_criteria_met: false
strategy_id: NULL
initiative_id: ANG-I-0008
---

# Implement Flox Python bindings and Flox class

## Objective

Create PyO3 Python bindings for the Flox integration, exposing the `Flox` class with activate/deactivate functionality mirroring VirtualEnv.

## Acceptance Criteria

## Acceptance Criteria

- [x] `Flox` pyclass with `__init__(path)` accepting directory containing manifest.toml
- [x] `exists` property - Check if `.flox/` directory exists
- [x] `has_manifest` property - Check if manifest.toml exists
- [x] `activate()` method - Save original `os.environ`, apply Flox env modifications
- [x] `deactivate()` method - Restore original environment state
- [x] `run()` method - Run commands within Flox environment
- [ ] `services` property - Returns `FloxServices` instance (deferred to ANG-T-0015)
- [x] `__enter__`/`__exit__` for context manager support
- [x] `is_available()` classmethod - Check if Flox CLI is installed
- [x] `version()` classmethod - Return Flox version string
- [x] Python tests for activate/deactivate cycle (27 tests passing)

## Implementation Notes

### File Location
```
crates/angreal/src/python_bindings/integrations/flox.rs
```

### Activation Pattern
Mirror VirtualEnv's approach:
1. Save `os.environ` state (PATH, any FLOX_* vars)
2. Run `flox activate --print-script` and parse output
3. Apply env var changes to `os.environ`
4. Set `_is_activated = true`

### Pattern Reference
See `crates/angreal/src/python_bindings/venv.rs` for VirtualEnv implementation.

### Dependencies
- Requires ANG-T-0013 (core Rust module)

## Status Updates

### Completed

**Files Created:**
- `crates/angreal/src/python_bindings/integrations/flox.rs` - Flox pyclass with all methods
- `py_tests/integrations/test_flox.py` - 27 tests for Flox class

**Files Modified:**
- `crates/angreal/src/python_bindings/integrations/mod.rs` - Added flox module registration

**Implementation Details:**
- Flox class mirrors VirtualEnv pattern for activate/deactivate
- Environment changes applied via `os.environ` modifications
- Original environment saved and restored on deactivate
- Context manager support for automatic cleanup
- `run()` method for executing commands within Flox environment
- All tests passing (27 total)

**Note:** The `services` property is deferred to ANG-T-0015 which implements FloxServices and FloxServiceHandle classes.
