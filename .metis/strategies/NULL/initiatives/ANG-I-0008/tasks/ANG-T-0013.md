---
id: implement-core-flox-rust
level: task
title: "Implement core Flox Rust integration module"
short_code: "ANG-T-0013"
created_at: 2026-01-13T01:30:12.698148+00:00
updated_at: 2026-01-13T01:38:14.708478+00:00
parent: ANG-I-0008
blocked_by: []
archived: false

tags:
  - "#task"
  - "#phase/completed"


exit_criteria_met: false
strategy_id: NULL
initiative_id: ANG-I-0008
---

# Implement core Flox Rust integration module

## Objective

Create the core Rust module at `crates/angreal/src/integrations/flox/mod.rs` that wraps the Flox CLI, providing the foundation for all Flox operations.

## Acceptance Criteria

## Acceptance Criteria

## Acceptance Criteria

- [ ] `FloxIntegration` struct with path to Flox environment
- [ ] `is_available()` - Check if `flox` binary exists and is executable
- [ ] `version()` - Run `flox --version` and return version string
- [ ] `get_activation_env()` - Parse `flox activate --print-script` to extract environment variable changes
- [ ] `run_in_env(cmd)` - Execute command via `flox activate -- CMD`
- [ ] `services_start(services)` - Run `flox services start [svc...]`
- [ ] `services_stop()` - Run `flox services stop`
- [ ] `services_status()` - Parse `flox services status` output to get service names, status, and PIDs
- [ ] Unit tests with mocked CLI output

## Implementation Notes

### File Location
```
crates/angreal/src/integrations/flox/mod.rs
```

### Key CLI Commands to Wrap
| Command | Purpose |
|---------|---------|
| `flox --version` | Availability check |
| `flox activate --print-script` | Get env modifications |
| `flox activate -- CMD` | Run command in env |
| `flox services start/stop/status` | Service lifecycle |

### Pattern Reference
Follow the UV integration pattern in `crates/angreal/src/integrations/uv/mod.rs` for structure.

## Status Updates

### Session 1 - Implementation Complete
- Created `crates/angreal/src/integrations/flox/mod.rs`
- Implemented `FloxIntegration` struct with `is_available()` and `version()`
- Implemented `FloxEnvironment` struct with:
  - `new()`, `exists()`, `manifest_path()`, `has_manifest()`
  - `get_activation_env()` - parses `flox activate --print-script` output
  - `run_in_env()` - executes commands via `flox activate -- CMD`
  - `services_start()`, `services_stop()`, `services_status()`, `services_logs()`, `services_restart()`
- Implemented `ServiceStatus` struct for service status representation
- Added 17 unit tests covering parsing logic
- Registered module in `integrations/mod.rs`
- All tests passing
