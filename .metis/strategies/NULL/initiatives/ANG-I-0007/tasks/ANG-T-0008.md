---
id: add-mcp-tool-discovery-test
level: task
title: "Add MCP tool discovery test"
short_code: "ANG-T-0008"
created_at: 2025-12-31T14:49:24.760285+00:00
updated_at: 2025-12-31T14:49:24.760285+00:00
parent: ANG-I-0007
blocked_by: []
archived: false

tags:
  - "#task"
  - "#phase/todo"


exit_criteria_met: false
strategy_id: NULL
initiative_id: ANG-I-0007
---

# Add MCP tool discovery test

## Parent Initiative

[[ANG-I-0007]] - MCP Server and Installation Testing

## Objective

Create an automated test that verifies the MCP server correctly discovers and exposes angreal tasks as MCP tools. When run inside an angreal project, the server should return tools matching the project's task definitions.

## Acceptance Criteria

- [ ] Test starts MCP server in angreal project directory
- [ ] Test sends `tools/list` request after initialization
- [ ] Test verifies tools are returned in response
- [ ] Test confirms expected tools exist (e.g., `test`, `dev`, `docs` groups)
- [ ] Test validates tool descriptions are present
- [ ] Test verifies tool input schemas are valid JSON Schema

## Implementation Notes

### Technical Approach

Add to `.angreal/task_tests.py`:

```python
def test_mcp_tool_discovery():
    """Test MCP server discovers project tools."""
    proc = start_mcp_server()  # helper from ANG-T-0007

    # Initialize first
    send_request(proc, {
        "jsonrpc": "2.0",
        "id": 1,
        "method": "initialize",
        "params": {...}
    })
    read_response(proc)

    # Request tool list
    send_request(proc, {
        "jsonrpc": "2.0",
        "id": 2,
        "method": "tools/list",
        "params": {}
    })

    response = read_response(proc)
    tools = response["result"]["tools"]

    # Verify expected tools exist
    tool_names = [t["name"] for t in tools]
    assert "test_all" in tool_names or "test-all" in tool_names

    # Verify tool has description
    for tool in tools:
        assert "description" in tool
        assert len(tool["description"]) > 0

        # Verify input schema if present
        if "inputSchema" in tool:
            assert tool["inputSchema"].get("type") == "object"

    proc.terminate()
```

### Dependencies

- Depends on ANG-T-0007 for MCP server helpers
- Must run from angreal project root (this repo)

### Risk Considerations

- Tool naming may use underscores or hyphens - check both
- Empty project should return zero tools gracefully
