---
id: integrate-mcp-and-smoke-tests-into
level: task
title: "Integrate MCP and smoke tests into CI"
short_code: "ANG-T-0010"
created_at: 2025-12-31T14:49:25.073810+00:00
updated_at: 2025-12-31T14:49:25.073810+00:00
parent: ANG-I-0007
blocked_by: [ANG-T-0007, ANG-T-0008, ANG-T-0009]
archived: true

tags:
  - "#task"
  - "#phase/todo"


exit_criteria_met: false
strategy_id: NULL
initiative_id: ANG-I-0007
---

# Integrate MCP and smoke tests into CI

## Parent Initiative

[[ANG-I-0007]] - MCP Server and Installation Testing

## Objective

Add the new MCP server tests and installation smoke tests to the GitHub Actions CI pipeline so regressions are caught before merge/release.

## Acceptance Criteria

## Acceptance Criteria

- [ ] MCP tests run as part of test workflow on PRs
- [ ] Smoke tests run after wheel build in release workflow
- [ ] Tests run on all platforms (Linux, macOS, Windows)
- [ ] Failures block PR merge / release
- [ ] Test results visible in GitHub Actions UI
- [ ] Total CI time increase < 5 minutes

## Implementation Notes

### Technical Approach

#### 1. Update test.yaml

Add MCP tests to existing test job:

```yaml
- name: Run MCP tests
  run: |
    angreal test mcp
```

#### 2. Update release.yaml

Add smoke tests after wheel build, before upload:

```yaml
- name: Run smoke tests
  run: |
    # Install the just-built wheel
    pip install dist/*.whl

    # Run smoke tests
    angreal --version
    angreal --help

    # Quick MCP startup test
    timeout 3 angreal mcp || true
    # Check no panic in dmesg/stderr
```

#### 3. Add test mcp command

Update `.angreal/task_tests.py` to include:

```python
@test()
@angreal.command(name="mcp", about="Run MCP server tests")
def test_mcp():
    """Run all MCP server tests."""
    test_mcp_server_startup()
    test_mcp_tool_discovery()
    print("âœ… All MCP tests passed!")
```

#### 4. Update test all

```python
def all_tests():
    # ... existing tests ...
    print("\n4. Running MCP tests...")
    test_mcp()
```

### Dependencies

- ANG-T-0007: MCP startup test implementation
- ANG-T-0008: MCP tool discovery test implementation
- ANG-T-0009: Smoke test implementation

### Risk Considerations

- MCP tests may be flaky due to timing - add retries
- Smoke tests are slow - run in parallel with other jobs if possible
- Windows may need special handling for process management
